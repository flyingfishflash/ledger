---
dryRun: true
preset: "simple"
verbosity: "DEBUG"
releasePrefix: "v"
changelog:
  path: "build/CHANGELOG.md"
  template: ".nyx-changelog.template"
  sections:
    "Added": "^feat$"
    "Changed": "(^refactor$|^perf$)"
    "Fixed": "^fix$"
    "Continuous Integration": "^ci$"
    "Build": "^build$"
    "Tests": "^test$"
    "Documentation": "^docs$"
commitMessageConventions:
  enabled:
    - conventionalCommitsCustom
  items:
    conventionalCommitsCustom:
      expression: "(?m)^(?<type>[a-zA-Z0-9_]+)(!)?(\\((?<scope>[a-z ]+)\\))?:( (?<title>.+))$(?s).*"
      bumpExpressions:
        major: "(?s)(?m)^[a-zA-Z0-9_]+(!|.*^(BREAKING( |-)CHANGE: )).*"
        minor: "(?s)(?m)^feat(?!!|.*^(BREAKING( |-)CHANGE: )).*"
        patch: "(?s)(?m)(^fix|^perf|^refactor)(?!!|.*^(BREAKING( |-)CHANGE: )).*"
git:
  remotes:
    origin:
      authenticationMethod: USER_PASSWORD
      user: "{{#environmentVariable}}NYX_GIT_FLYINGFISHFLASH_USER{{/environmentVariable}}"
      password: "{{#environmentVariable}}NYX_GIT_FLYINGFISHFLASH_PASSWORD{{/environmentVariable}}"
releaseTypes:
  enabled:
    - mainline
    - release
    - internal
  publicationServices:
    - codeberg
    - flyingfishflash
    - github
#    - gitlab
  remoteRepositories:
    - origin
  items:
    mainline:
      collapseVersions: false
      description: "{{#fileContent}}build/CHANGELOG.md{{/fileContent}}"
      filterTags: "^({{configuration.releasePrefix}})?([0-9]\\d*)\\.([0-9]\\d*)\\.([0-9]\\d*)$"
      gitCommit: "false"
      gitPush: "true"
      gitTag: "true"
      matchBranches: "^main$"
      matchEnvironmentVariables:
        CI: "^true$"
      matchWorkspaceStatus: "CLEAN"
      publish: "false"
    release:
      collapseVersions: false
      description: "{{#fileContent}}build/CHANGELOG.md{{/fileContent}}"
      filterTags: "^({{configuration.releasePrefix}})?([0-9]\\d*)\\.([0-9]\\d*)\\.([0-9]\\d*)$"
      gitCommit: "false"
      gitPush: "true"
      gitTag: "true"
      matchBranches: "^release$"
      matchEnvironmentVariables:
        CI: "^true$"
      matchWorkspaceStatus: "CLEAN"
      publish: "true"
    internal:
      collapseVersions: true
      collapsedVersionQualifier: "{{#lower}}{{branch}}{{/lower}}"
      filterTags: "^({{configuration.releasePrefix}})?([0-9]\\d*)\\.([0-9]\\d*)\\.([0-9]\\d*)$"
      gitCommit: "false"
      gitPush: "false"
      gitTag: "false"
      publish: "false"
services:
  codeberg:
    type: "GITHUB"
    options:
      AUTHENTICATION_TOKEN: "{{#environmentVariable}}NYX_GIT_CODEBERG_TOKEN{{/environmentVariable}}"
      BASE_URI: "https://codeberg.org/api/v1"
      REPOSITORY_NAME: "ledger"
      REPOSITORY_OWNER: "flyingfishflash"
  flyingfishflash:
    type: "GITHUB"
    options:
      AUTHENTICATION_TOKEN: "{{#environmentVariable}}NYX_GIT_FLYINGFISHFLASH_TOKEN{{/environmentVariable}}"
      BASE_URI: "https://gitea.flyingfishflash.net/api/v1"
      REPOSITORY_NAME: "ledger"
      REPOSITORY_OWNER: "flyingfishflash"
  github:
    type: "GITHUB"
    options:
      AUTHENTICATION_TOKEN: "{{#environmentVariable}}NYX_GIT_GITHUB_TOKEN{{/environmentVariable}}"
      REPOSITORY_NAME: "ledger"
      REPOSITORY_OWNER: "flyingfishflash"
  gitlab:
    type: "GITLAB"
    options:
      AUTHENTICATION_TOKEN: "{{#environmentVariable}}NYX_GIT_GITLAB_TOKEN{{/environmentVariable}}"
      REPOSITORY_NAME: "ledger"
      REPOSITORY_OWNER: "flyingfishflash"
